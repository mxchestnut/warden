import{r,j as o}from"./editor-B5c-jJ5G.js";import{a as E}from"./index-COTfgfla.js";import{N as D}from"./Navigation-CX4szzWA.js";import{k as U}from"./lucide-BWvA7acy.js";import"./matrix-DowZW4Yz.js";function J(){const[t,S]=r.useState(null),[P,x]=r.useState(!0),[n,u]=r.useState("profile"),[W,I]=r.useState(!1),[f,s]=r.useState(null),[C,a]=r.useState(null),[d,j]=r.useState(""),[l,h]=r.useState(""),[i,c]=r.useState(!1),[B,k]=r.useState(""),[g,w]=r.useState(!1),[m,v]=r.useState(!1);r.useEffect(()=>{y(),F()},[]);const y=async()=>{try{x(!0);const e=await E.getCurrentUser();e&&S({...e,pathCompanionConnected:!!e.pathcompanionUsername,pathCompanionUsername:e.pathcompanionUsername||""})}catch(e){console.error("Failed to load user:",e),s("Failed to load profile")}finally{x(!1)}},F=async()=>{try{const e=await fetch("/api/auth/discord-settings",{credentials:"include"});if(e.ok){const p=await e.json();w(p.hasToken)}}catch(e){console.error("Failed to load Discord settings:",e)}},T=async()=>{if(!d||!l){s("Please enter both username and password");return}try{c(!0),s(null),a(null);const e=await fetch("/api/auth/pathcompanion/connect",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:d,password:l})});if(!e.ok){const b=await e.json();throw new Error(b.error||"Failed to connect PathCompanion account")}const p=await e.json();a("PathCompanion account connected successfully!"),h(""),await y()}catch(e){s(e instanceof Error?e.message:"Failed to connect PathCompanion")}finally{c(!1)}},A=async()=>{if(confirm("Are you sure you want to disconnect your PathCompanion account?"))try{if(c(!0),s(null),a(null),!(await fetch("/api/auth/pathcompanion/disconnect",{method:"POST",credentials:"include"})).ok)throw new Error("Failed to disconnect PathCompanion account");a("PathCompanion account disconnected successfully"),j(""),h(""),await y()}catch(e){s(e instanceof Error?e.message:"Failed to disconnect PathCompanion")}finally{c(!1)}},R=async()=>{try{v(!0),s(null),a(null);const e=await fetch("/api/auth/discord-settings",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({botToken:B||null})});if(!e.ok){const b=await e.json();throw new Error(b.error||"Failed to save Discord settings")}const p=await e.json();a("Discord bot token saved successfully!"),w(p.hasToken),k("")}catch(e){s(e instanceof Error?e.message:"Failed to save Discord settings")}finally{v(!1)}};return P?o.jsxs("div",{style:{display:"flex",minHeight:"100vh",backgroundColor:"#37322E"},children:[o.jsx(D,{user:t}),o.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx("p",{style:{color:"white"},children:"Loading..."})})]}):o.jsxs("div",{style:{display:"flex",minHeight:"100vh",backgroundColor:"#37322E"},children:[o.jsx(D,{user:t}),o.jsxs("div",{style:{flex:1,padding:"2rem",maxWidth:"1200px",margin:"0 auto"},children:[o.jsxs("div",{style:{marginBottom:"2rem"},children:[o.jsx("h1",{style:{fontSize:"2rem",fontWeight:"bold",color:"white",marginBottom:"0.5rem"},children:"Profile & Settings"}),o.jsx("p",{style:{color:"#B3B2B0"},children:"Manage your account settings and integrations"})]}),f&&o.jsx("div",{style:{backgroundColor:"#7F1D1D",color:"white",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem"},children:f}),C&&o.jsx("div",{style:{backgroundColor:"#065F46",color:"white",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem"},children:C}),o.jsx("div",{style:{borderBottom:"2px solid #4A4540",marginBottom:"2rem"},children:o.jsxs("div",{style:{display:"flex",gap:"2rem"},children:[o.jsx("button",{onClick:()=>u("profile"),style:{padding:"1rem",color:n==="profile"?"#D4AF37":"#B3B2B0",borderBottom:n==="profile"?"2px solid #D4AF37":"none",background:"none",border:"none",cursor:"pointer",fontWeight:n==="profile"?"bold":"normal"},children:"Profile"}),o.jsx("button",{onClick:()=>u("pathcompanion"),style:{padding:"1rem",color:n==="pathcompanion"?"#D4AF37":"#B3B2B0",borderBottom:n==="pathcompanion"?"2px solid #D4AF37":"none",background:"none",border:"none",cursor:"pointer",fontWeight:n==="pathcompanion"?"bold":"normal"},children:"PathCompanion"}),o.jsx("button",{onClick:()=>u("discord"),style:{padding:"1rem",color:n==="discord"?"#D4AF37":"#B3B2B0",borderBottom:n==="discord"?"2px solid #D4AF37":"none",background:"none",border:"none",cursor:"pointer",fontWeight:n==="discord"?"bold":"normal"},children:"Discord Bot"})]})}),n==="profile"&&t&&o.jsxs("div",{style:{backgroundColor:"#4A4540",borderRadius:"0.75rem",padding:"2rem"},children:[o.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"white",marginBottom:"1.5rem"},children:"Account Information"}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"Username"}),o.jsx("input",{type:"text",value:t.username,disabled:!0,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"#888",cursor:"not-allowed"}})]}),o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"Account ID"}),o.jsx("input",{type:"text",value:t.id,disabled:!0,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"#888",cursor:"not-allowed"}})]}),t.isAdmin&&o.jsx("div",{style:{backgroundColor:"#B34B0C",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",display:"inline-block"},children:o.jsx("strong",{children:"Admin Account"})})]})]}),n==="pathcompanion"&&o.jsxs("div",{style:{backgroundColor:"#4A4540",borderRadius:"0.75rem",padding:"2rem"},children:[o.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"white",marginBottom:"1rem"},children:"PathCompanion Integration"}),o.jsx("p",{style:{color:"#B3B2B0",marginBottom:"1.5rem"},children:"Connect your PathCompanion account to sync characters and access game features."}),t?.pathCompanionConnected?o.jsxs("div",{children:[o.jsxs("div",{style:{backgroundColor:"#065F46",color:"white",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[o.jsx(U,{className:"w-5 h-5"}),o.jsxs("span",{children:["Connected as ",o.jsx("strong",{children:t.pathCompanionUsername})]})]}),o.jsx("button",{onClick:A,disabled:i,style:{backgroundColor:"#7F1D1D",color:"white",padding:"0.75rem 1.5rem",borderRadius:"0.5rem",border:"none",cursor:i?"not-allowed":"pointer",opacity:i?.6:1},children:i?"Disconnecting...":"Disconnect PathCompanion"})]}):o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"PathCompanion Username"}),o.jsx("input",{type:"text",value:d,onChange:e=>j(e.target.value),placeholder:"Enter your PathCompanion username",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"white"}})]}),o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"PathCompanion Password"}),o.jsx("input",{type:"password",value:l,onChange:e=>h(e.target.value),placeholder:"Enter your PathCompanion password",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"white"}})]}),o.jsx("button",{onClick:T,disabled:i||!d||!l,style:{backgroundColor:"#B34B0C",color:"white",padding:"0.75rem 1.5rem",borderRadius:"0.5rem",border:"none",cursor:i||!d||!l?"not-allowed":"pointer",opacity:i||!d||!l?.6:1},children:i?"Connecting...":"Connect PathCompanion"})]})]}),n==="discord"&&o.jsxs("div",{style:{backgroundColor:"#4A4540",borderRadius:"0.75rem",padding:"2rem"},children:[o.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"white",marginBottom:"1rem"},children:"Discord Bot Settings"}),o.jsx("p",{style:{color:"#B3B2B0",marginBottom:"1.5rem"},children:"Configure your personal Discord bot token for character webhooks and notifications."}),g&&o.jsx("div",{style:{backgroundColor:"#065F46",color:"white",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem"},children:"Discord bot token is configured"}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"Discord Bot Token"}),o.jsx("input",{type:"password",value:B,onChange:e=>k(e.target.value),placeholder:g?"Enter new token to update":"Enter your Discord bot token",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"white"}})]}),o.jsx("button",{onClick:R,disabled:m,style:{backgroundColor:"#B34B0C",color:"white",padding:"0.75rem 1.5rem",borderRadius:"0.5rem",border:"none",cursor:m?"not-allowed":"pointer",opacity:m?.6:1},children:m?"Saving...":g?"Update Token":"Save Token"})]})]})]})]})}export{J as ProfileSettings};
