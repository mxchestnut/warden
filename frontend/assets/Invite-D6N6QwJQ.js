import{r as o,j as e}from"./editor-B5c-jJ5G.js";import{a as m}from"./index-B7SUTsl0.js";import{L as f,a as j,U as I,D as k}from"./lucide-Do81zF_g.js";import"./matrix-DowZW4Yz.js";const h="";function F(){const[c,n]=o.useState("loading"),[w,p]=o.useState(""),[d,l]=o.useState(""),[u,x]=o.useState(null),[i,b]=o.useState(null),[v,g]=o.useState(!1),[r,B]=o.useState(null);o.useEffect(()=>{(async()=>{const a=await m.getCurrentUser();B(a)})()},[]),o.useEffect(()=>{r!==null&&N()},[r]);const N=async()=>{const a=window.location.pathname.split("/invite/")[1];if(!a){n("invalid"),l("Invalid invitation link");return}try{const t=await fetch(`${h}/api/v1/groups/invitations/verify/${a}`);if(t.ok){const s=await t.json();x("group"),b(s),p(s.email),n("valid");return}}catch(t){console.error("[Invite] Error checking group invitation:",t)}try{const s=await(await fetch(`${h}/api/v1/invitations/verify/${a}`)).json();s.valid?(x("platform"),n("valid"),p(s.email),l(s.message),localStorage.setItem("invitation_token",a),localStorage.setItem("invitation_email",s.email),setTimeout(()=>{window.location.href="/login"},2e3)):(n("invalid"),l(s.message))}catch(t){console.error("[Invite] Error verifying invitation:",t),n("invalid"),l("Failed to verify invitation")}},C=async()=>{if(!i)return;const a=window.location.pathname.split("/invite/")[1];g(!0);try{const t=await fetch(`${h}/api/v1/groups/invitations/accept/${a}`,{method:"POST",credentials:"include",headers:{Authorization:`Bearer ${m.getAccessToken()}`}});if(t.ok){const s=await t.json();n("success"),l(`You've successfully joined ${i.group_name}!`),setTimeout(()=>{window.location.href=`/group/${s.slug||i.group_slug}`},2e3)}else{const s=await t.json();n("invalid"),l(s.detail||"Failed to accept invitation")}}catch(t){console.error("[Invite] Error accepting invitation:",t),n("invalid"),l("Failed to accept invitation")}finally{g(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",style:{backgroundColor:"#37322E"},children:e.jsxs("div",{className:"max-w-md w-full p-8 rounded-lg text-center",style:{backgroundColor:"#524944"},children:[c==="loading"&&e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-16 h-16 mx-auto mb-4 animate-spin",style:{color:"#B34B0C"}}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Verifying Invitation"}),e.jsx("p",{style:{color:"#B3B2B0"},children:"Please wait while we verify your invitation..."})]}),c==="valid"&&u==="platform"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-16 h-16 mx-auto mb-4",style:{color:"#10b981"}}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Welcome to Warden!"}),e.jsx("p",{className:"text-lg mb-4 text-white",children:w}),e.jsx("p",{style:{color:"#B3B2B0"},className:"mb-4",children:d}),e.jsx("p",{style:{color:"#B3B2B0"},children:"Redirecting you to sign up..."})]}),c==="valid"&&u==="group"&&i&&e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-16 h-16 mx-auto mb-4",style:{color:"#B34B0C"}}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"You're Invited!"}),e.jsxs("div",{className:"text-left mb-6 p-4 rounded",style:{backgroundColor:"#37322E"},children:[e.jsx("p",{className:"text-sm",style:{color:"#B3B2B0"},children:"You've been invited to join"}),e.jsx("p",{className:"text-xl font-bold text-white mt-1",children:i.group_name}),e.jsxs("p",{className:"text-sm mt-3",style:{color:"#B3B2B0"},children:["Role: ",e.jsx("span",{className:"font-semibold text-white",children:i.role})]}),i.message&&e.jsx("div",{className:"mt-3 pt-3 border-t",style:{borderColor:"#524944"},children:e.jsxs("p",{className:"text-sm italic",style:{color:"#B3B2B0"},children:['"',i.message,'"']})})]}),r?r.email!==i.email?e.jsxs("div",{children:[e.jsxs("p",{style:{color:"#ef4444"},className:"mb-4",children:["This invitation was sent to ",i.email,", but you're signed in as ",r.email,"."]}),e.jsx("p",{style:{color:"#B3B2B0"},className:"mb-4",children:"Please sign in with the correct account to accept this invitation."}),e.jsx("button",{onClick:async()=>{await m.logout(),window.location.href="/login"},className:"w-full px-6 py-3 rounded-lg font-semibold text-white hover:opacity-90 transition-opacity",style:{backgroundColor:"#B34B0C"},children:"Sign In with Different Account"})]}):e.jsx("button",{onClick:C,disabled:v,className:"w-full px-6 py-3 rounded-lg font-semibold text-white hover:opacity-90 transition-opacity disabled:opacity-50",style:{backgroundColor:"#B34B0C"},children:v?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 animate-spin"}),"Accepting..."]}):"Accept Invitation"}):e.jsxs("div",{children:[e.jsx("p",{style:{color:"#B3B2B0"},className:"mb-4",children:"Please sign in to accept this invitation"}),e.jsx("button",{onClick:()=>window.location.href="/login",className:"w-full px-6 py-3 rounded-lg font-semibold text-white hover:opacity-90 transition-opacity",style:{backgroundColor:"#B34B0C"},children:"Sign In to Accept"})]})]}),c==="success"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-16 h-16 mx-auto mb-4",style:{color:"#10b981"}}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Success!"}),e.jsx("p",{style:{color:"#B3B2B0"},className:"mb-4",children:d}),e.jsx("p",{style:{color:"#B3B2B0"},children:"Redirecting you to the group..."})]}),c==="invalid"&&e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-16 h-16 mx-auto mb-4",style:{color:"#ef4444"}}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Invalid Invitation"}),e.jsx("p",{style:{color:"#B3B2B0"},className:"mb-6",children:d}),e.jsx("button",{onClick:()=>window.location.href="/",className:"px-6 py-3 rounded-lg font-semibold text-white hover:opacity-90 transition-colors",style:{backgroundColor:"#B34B0C"},children:"Go to Home"})]})]})})}export{F as Invite,F as default};
