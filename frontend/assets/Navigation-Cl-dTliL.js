import{r as d,j as e}from"./editor-B5c-jJ5G.js";import{a as M}from"./index-C1s9jAo-.js";import{D as N,F as C,X as u,o as T,G as D,x as v,J as k,K as f,N as E,w as F,O as L,Q as z,V as I,W as O}from"./lucide-BWvA7acy.js";function P(){const[o,x]=d.useState([]),[l,i]=d.useState(0),[r,s]=d.useState(!1),[h,g]=d.useState(!1),m=d.useRef(null);d.useEffect(()=>{j();const t=setInterval(j,3e4),a=n=>{m.current&&!m.current.contains(n.target)&&s(!1)};return document.addEventListener("mousedown",a),()=>{clearInterval(t),document.removeEventListener("mousedown",a)}},[]);const j=async()=>{try{const t=localStorage.getItem("access_token"),a=await fetch("http://localhost:8000/api/v1/notifications?limit=10",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(a.ok){const n=await a.json();x(n.notifications),i(n.unread_count)}}catch(t){console.error("Failed to load notifications:",t)}},b=async t=>{try{const a=localStorage.getItem("access_token");await fetch(`http://localhost:8000/api/v1/notifications/${t}/read`,{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}),x(o.map(n=>n.id===t?{...n,is_read:!0}:n)),i(Math.max(0,l-1))}catch(a){console.error("Failed to mark notification as read:",a)}},B=async()=>{g(!0);try{const t=localStorage.getItem("access_token");await fetch("http://localhost:8000/api/v1/notifications/read-all",{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),x(o.map(a=>({...a,is_read:!0}))),i(0)}catch(t){console.error("Failed to mark all as read:",t)}finally{g(!1)}},$=async t=>{try{const a=localStorage.getItem("access_token");await fetch(`http://localhost:8000/api/v1/notifications/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});const n=o.find(c=>c.id===t);x(o.filter(c=>c.id!==t)),n&&!n.is_read&&i(Math.max(0,l-1))}catch(a){console.error("Failed to delete notification:",a)}},A=t=>{t.is_read||b(t.id),t.action_url&&(window.location.href=t.action_url),s(!1)},S=t=>{switch(t){case"follow":return"ðŸ‘¤";case"comment":return"ðŸ’¬";case"mention":return"@";case"like":return"â¤ï¸";case"share":return"ðŸ”—";case"collaboration_invite":return"ðŸ¤";case"beta_request":return"ðŸ“–";default:return"ðŸ””"}},_=t=>{const a=new Date(t),c=new Date().getTime()-a.getTime(),p=Math.floor(c/6e4),y=Math.floor(c/36e5),w=Math.floor(c/864e5);return p<1?"Just now":p<60?`${p}m ago`:y<24?`${y}h ago`:w<7?`${w}d ago`:a.toLocaleDateString()};return e.jsxs("div",{className:"relative",ref:m,children:[e.jsxs("button",{onClick:()=>s(!r),className:"relative p-2 text-gray-400 hover:text-white transition-colors","aria-label":"Notifications",children:[e.jsx(N,{className:"w-6 h-6"}),l>0&&e.jsx("span",{className:"absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full",children:l>99?"99+":l})]}),r&&e.jsxs("div",{className:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-[600px] flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Notifications"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[l>0&&e.jsx("button",{onClick:B,disabled:h,className:"text-sm text-indigo-600 hover:text-indigo-800 disabled:opacity-50",title:"Mark all as read",children:e.jsx(C,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(u,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-y-auto flex-1",children:o.length===0?e.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No notifications yet"})]}):e.jsx("ul",{children:o.map(t=>e.jsx("li",{className:`border-b border-gray-100 last:border-b-0 ${t.is_read?"bg-white":"bg-indigo-50"} hover:bg-gray-50 transition-colors`,children:e.jsxs("div",{className:"px-4 py-3 flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 text-2xl",children:S(t.type)}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>A(t),children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:t.message}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:_(t.created_at)})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[!t.is_read&&e.jsx("button",{onClick:a=>{a.stopPropagation(),b(t.id)},className:"text-indigo-600 hover:text-indigo-800",title:"Mark as read",children:e.jsx(C,{className:"w-4 h-4"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),$(t.id)},className:"text-gray-400 hover:text-red-600",title:"Delete",children:e.jsx(T,{className:"w-4 h-4"})})]})]})},t.id))})}),o.length>0&&e.jsx("div",{className:"px-4 py-3 border-t border-gray-200 text-center",children:e.jsx("a",{href:"/notifications",className:"text-sm text-indigo-600 hover:text-indigo-800 font-medium",onClick:()=>s(!1),children:"View all notifications"})})]})]})}function H({user:o,currentPage:x}){const[l,i]=d.useState(!1),r=h=>{window.location.href=h,i(!1)},s=h=>window.location.pathname===h||x===h;return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"border-b sticky top-0 z-50 shadow-sm",style:{backgroundColor:"#524944",borderColor:"#6C6A68"},children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>i(!l),className:"p-2 rounded-lg transition-colors text-white hover:bg-opacity-20",style:{backgroundColor:l?"rgba(179, 75, 12, 0.2)":"transparent"},"aria-label":"Toggle menu",children:l?e.jsx(u,{className:"w-6 h-6"}):e.jsx(D,{className:"w-6 h-6"})}),e.jsxs("button",{onClick:()=>r("/"),className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[e.jsx(v,{className:"w-8 h-8",style:{color:"#B34B0C"}}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Warden"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>r("/feed"),className:`hidden md:flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${s("/feed")?"text-white font-medium":"text-white hover:bg-opacity-20"}`,style:s("/feed")?{backgroundColor:"#B34B0C"}:{},children:[e.jsx(k,{className:"w-5 h-5"}),e.jsx("span",{children:"Feed"})]}),e.jsxs("button",{onClick:()=>r("/characters"),className:`hidden md:flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${s("/characters")?"text-white font-medium":"text-white hover:bg-opacity-20"}`,style:s("/characters")?{backgroundColor:"#B34B0C"}:{},children:[e.jsx(f,{className:"w-5 h-5"}),e.jsx("span",{children:"Characters"})]}),o&&e.jsx(P,{})]}):e.jsxs("button",{onClick:()=>r("/login"),className:"px-6 py-2 rounded-lg flex items-center gap-2 transition-colors text-white hover:opacity-90",style:{backgroundColor:"#B34B0C"},children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{children:"Log In"})]})})]})})}),e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity ${l?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:()=>i(!1)}),e.jsx("aside",{className:`fixed top-0 left-0 h-full w-80 shadow-2xl z-50 transform transition-transform ${l?"translate-x-0":"-translate-x-full"}`,style:{backgroundColor:"#37322E"},children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-6 border-b",style:{borderColor:"#6C6A68"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-7 h-7",style:{color:"#B34B0C"}}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Warden"})]}),e.jsx("button",{onClick:()=>i(!1),className:"p-2 rounded-lg text-white hover:bg-opacity-20",style:{backgroundColor:"rgba(179, 75, 12, 0.1)"},children:e.jsx(u,{className:"w-5 h-5"})})]}),o&&e.jsxs("div",{className:"rounded-lg p-3",style:{backgroundColor:"#524944"},children:[e.jsx("p",{className:"font-medium text-white",children:o.username}),e.jsx("p",{className:"text-sm",style:{color:"#B3B2B0"},children:o.email||"No email set"})]})]}),e.jsx("nav",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"px-3 text-xs font-semibold uppercase tracking-wider mb-2",style:{color:"#B3B2B0"},children:"Main"}),e.jsxs("button",{onClick:()=>r("/feed"),className:`w-full flex items-center gap-3 px-3 py-3 rounded-lg transition-colors ${s("/feed")?"font-medium text-white":"text-white hover:bg-opacity-20"}`,style:s("/feed")?{backgroundColor:"#B34B0C"}:{},children:[e.jsx(k,{className:"w-5 h-5"}),e.jsx("span",{children:"Feed"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"px-3 text-xs font-semibold uppercase tracking-wider mb-2",style:{color:"#B3B2B0"},children:"Characters"}),e.jsxs("button",{onClick:()=>r("/characters"),className:`w-full flex items-center gap-3 px-3 py-3 rounded-lg transition-colors ${s("/characters")?"font-medium text-white":"text-white hover:bg-opacity-20"}`,style:s("/characters")?{backgroundColor:"#B34B0C"}:{},children:[e.jsx(f,{className:"w-5 h-5"}),e.jsx("span",{children:"My Characters"})]}),e.jsxs("button",{onClick:()=>r("/store"),className:`w-full flex items-center gap-3 px-3 py-3 rounded-lg transition-colors ${s("/store")?"font-medium text-white":"text-white hover:bg-opacity-20"}`,style:s("/store")?{backgroundColor:"#B34B0C"}:{},children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{children:"Books"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"px-3 text-xs font-semibold uppercase tracking-wider mb-2",style:{color:"#B3B2B0"},children:"Account"}),e.jsxs("button",{onClick:()=>r("/profile-settings"),className:`w-full flex items-center gap-3 px-3 py-3 rounded-lg transition-colors ${s("/profile-settings")?"font-medium text-white":"text-white hover:bg-opacity-20"}`,style:s("/profile-settings")?{backgroundColor:"#B34B0C"}:{},children:[e.jsx(f,{className:"w-5 h-5"}),e.jsx("span",{children:"Profile & Settings"})]}),e.jsxs("button",{onClick:()=>r("/dashboard"),className:`w-full flex items-center gap-3 px-3 py-3 rounded-lg transition-colors ${s("/dashboard")?"font-medium text-white":"text-white hover:bg-opacity-20"}`,style:s("/dashboard")?{backgroundColor:"#B34B0C"}:{},children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{children:"Dashboard"})]}),o?.isAdmin&&e.jsxs("button",{onClick:()=>r("/admin"),className:`w-full flex items-center gap-3 px-3 py-3 rounded-lg transition-colors ${s("/admin")?"font-medium text-white":"text-white hover:bg-opacity-20"}`,style:s("/admin")?{backgroundColor:"#B34B0C"}:{},children:[e.jsx(z,{className:"w-5 h-5"}),e.jsx("span",{children:"Admin Panel"})]}),o?.isAdmin&&e.jsxs("button",{onClick:()=>r("/staff"),className:`w-full flex items-center gap-3 px-3 py-3 rounded-lg transition-colors ${s("/staff")?"font-medium text-white":"text-white hover:bg-opacity-20"}`,style:s("/staff")?{backgroundColor:"#B34B0C"}:{},children:[e.jsx(I,{className:"w-5 h-5"}),e.jsx("span",{children:"Staff Panel"})]})]})]})}),e.jsx("div",{className:"p-6 border-t space-y-2",style:{borderColor:"#6C6A68"},children:o&&e.jsxs("button",{onClick:async()=>{await M.logout(),window.location.href="/"},className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg transition-colors hover:opacity-80",style:{color:"#B34B0C"},children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{children:"Log Out"})]})})]})})]})}export{H as N};
