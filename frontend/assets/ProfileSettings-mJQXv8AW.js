import{r,j as e}from"./editor-B5c-jJ5G.js";import{a as A}from"./index-Dyp_sm3x.js";import{N as j}from"./Navigation-CztJBz0i.js";import{k as D,l as F,m as R}from"./lucide-Do81zF_g.js";import"./matrix-DowZW4Yz.js";function O(){const[n,B]=r.useState(null),[w,h]=r.useState(!0),[t,g]=r.useState("profile"),[U,E]=r.useState(!1),[y,i]=r.useState(null),[x,l]=r.useState(null),[s,b]=r.useState(""),[c,m]=r.useState(""),[a,d]=r.useState(!1),[C,f]=r.useState(!1);r.useEffect(()=>{p()},[]);const p=async()=>{try{h(!0);const o=await A.getCurrentUser();o&&B({...o,pathCompanionConnected:!!o.pathcompanionUsername,pathCompanionUsername:o.pathcompanionUsername||""})}catch(o){console.error("Failed to load user:",o),i("Failed to load profile")}finally{h(!1)}},v=async()=>{if(!s||!c){i("Please enter both username and password");return}try{d(!0),i(null),l(null);const o=await fetch("/api/auth/pathcompanion/connect",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:s,password:c})});if(!o.ok){const S=await o.json();throw new Error(S.error||"Failed to connect PathCompanion account")}const u=await o.json();l("PathCompanion account connected successfully!"),m(""),await p()}catch(o){i(o instanceof Error?o.message:"Failed to connect PathCompanion")}finally{d(!1)}},k=async()=>{if(confirm("Are you sure you want to disconnect your PathCompanion account?"))try{if(d(!0),i(null),l(null),!(await fetch("/api/auth/pathcompanion/disconnect",{method:"POST",credentials:"include"})).ok)throw new Error("Failed to disconnect PathCompanion account");l("PathCompanion account disconnected successfully"),b(""),m(""),await p()}catch(o){i(o instanceof Error?o.message:"Failed to disconnect PathCompanion")}finally{d(!1)}},P=async()=>{if(n?.accountCode)try{await navigator.clipboard.writeText(n.accountCode),f(!0),setTimeout(()=>f(!1),2e3),console.log("Copied Account Code:",n.accountCode)}catch(o){console.error("Failed to copy:",o);const u=document.querySelector("input[readonly]");u&&u.select()}else console.error("No account code available to copy")};return w?e.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#37322E"},children:[e.jsx(j,{user:n}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"4rem"},children:e.jsx("p",{style:{color:"white"},children:"Loading..."})})]}):e.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#37322E"},children:[e.jsx(j,{user:n}),e.jsxs("div",{style:{padding:"2rem",maxWidth:"1200px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h1",{style:{fontSize:"2rem",fontWeight:"bold",color:"white",marginBottom:"0.5rem"},children:"Profile & Settings"}),e.jsx("p",{style:{color:"#B3B2B0"},children:"Manage your account settings and integrations"})]}),y&&e.jsx("div",{style:{backgroundColor:"#7F1D1D",color:"white",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem"},children:y}),x&&e.jsx("div",{style:{backgroundColor:"#065F46",color:"white",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem"},children:x}),e.jsx("div",{style:{borderBottom:"2px solid #4A4540",marginBottom:"2rem"},children:e.jsxs("div",{style:{display:"flex",gap:"2rem"},children:[e.jsx("button",{onClick:()=>g("profile"),style:{padding:"1rem",color:t==="profile"?"#D4AF37":"#B3B2B0",borderBottom:t==="profile"?"2px solid #D4AF37":"none",background:"none",border:"none",cursor:"pointer",fontWeight:t==="profile"?"bold":"normal"},children:"Profile"}),e.jsx("button",{onClick:()=>g("pathcompanion"),style:{padding:"1rem",color:t==="pathcompanion"?"#D4AF37":"#B3B2B0",borderBottom:t==="pathcompanion"?"2px solid #D4AF37":"none",background:"none",border:"none",cursor:"pointer",fontWeight:t==="pathcompanion"?"bold":"normal"},children:"PathCompanion"})]})}),t==="profile"&&n&&e.jsxs("div",{style:{backgroundColor:"#4A4540",borderRadius:"0.75rem",padding:"2rem"},children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"white",marginBottom:"1.5rem"},children:"Account Information"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"Username"}),e.jsx("input",{type:"text",value:n.username,disabled:!0,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"#888",cursor:"not-allowed"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"Account ID"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:"text",value:n.accountCode,readOnly:!0,onClick:o=>o.currentTarget.select(),style:{width:"100%",padding:"0.75rem",paddingRight:"3rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"#D4AF37",fontWeight:"bold",fontSize:"1.1rem",cursor:"text",userSelect:"all"}}),e.jsx("button",{onClick:P,style:{position:"absolute",right:"0.5rem",top:"50%",transform:"translateY(-50%)",backgroundColor:C?"#065F46":"#B34B0C",color:"white",padding:"0.5rem",borderRadius:"0.375rem",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",transition:"background-color 0.2s"},title:"Copy Account ID",children:C?e.jsx(D,{className:"w-4 h-4"}):e.jsx(F,{className:"w-4 h-4"})})]}),e.jsx("p",{style:{color:"#B3B2B0",fontSize:"0.875rem",marginTop:"0.5rem"},children:"Use this ID in Discord to sync your profile with the Warden bot"})]}),n.isAdmin&&e.jsx("div",{style:{backgroundColor:"#B34B0C",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",display:"inline-block"},children:e.jsx("strong",{children:"Admin Account"})})]})]}),t==="pathcompanion"&&e.jsxs("div",{style:{backgroundColor:"#4A4540",borderRadius:"0.75rem",padding:"2rem"},children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"white",marginBottom:"1rem"},children:"PathCompanion Integration"}),e.jsx("p",{style:{color:"#B3B2B0",marginBottom:"1.5rem"},children:"Connect your PathCompanion account to sync characters and access game features."}),n?.pathCompanionConnected?e.jsxs("div",{children:[e.jsxs("div",{style:{backgroundColor:"#065F46",color:"white",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(R,{className:"w-5 h-5"}),e.jsxs("span",{children:["Connected as ",e.jsx("strong",{children:n.pathCompanionUsername})]})]}),e.jsx("button",{onClick:k,disabled:a,style:{backgroundColor:"#7F1D1D",color:"white",padding:"0.75rem 1.5rem",borderRadius:"0.5rem",border:"none",cursor:a?"not-allowed":"pointer",opacity:a?.6:1},children:a?"Disconnecting...":"Disconnect PathCompanion"})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"PathCompanion Username"}),e.jsx("input",{type:"text",value:s,onChange:o=>b(o.target.value),placeholder:"Enter your PathCompanion username",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"white"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"PathCompanion Password"}),e.jsx("input",{type:"password",value:c,onChange:o=>m(o.target.value),placeholder:"Enter your PathCompanion password",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"white"}})]}),e.jsx("button",{onClick:v,disabled:a||!s||!c,style:{backgroundColor:"#B34B0C",color:"white",padding:"0.75rem 1.5rem",borderRadius:"0.5rem",border:"none",cursor:a||!s||!c?"not-allowed":"pointer",opacity:a||!s||!c?.6:1},children:a?"Connecting...":"Connect PathCompanion"})]})]})]})]})}export{O as ProfileSettings};
