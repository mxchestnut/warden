import{r as d,j as e}from"./editor-B5c-jJ5G.js";import{a as $}from"./index-C4-c_iSx.js";import{D as y,F as w,X as B,o as S,x as T,G as A,J as D,K as M}from"./lucide-Dju06cgn.js";function E(){const[n,c]=d.useState([]),[o,i]=d.useState(0),[x,r]=d.useState(!1),[N,f]=d.useState(!1),h=d.useRef(null);d.useEffect(()=>{u();const t=setInterval(u,3e4),s=a=>{h.current&&!h.current.contains(a.target)&&r(!1)};return document.addEventListener("mousedown",s),()=>{clearInterval(t),document.removeEventListener("mousedown",s)}},[]);const u=async()=>{try{const t=localStorage.getItem("access_token"),s=await fetch("/api/v1/notifications?limit=10",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(s.ok){const a=await s.json();c(a.notifications),i(a.unread_count)}}catch(t){console.error("Failed to load notifications:",t)}},p=async t=>{try{const s=localStorage.getItem("access_token");await fetch(`/api/v1/notifications/${t}/read`,{method:"PUT",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}}),c(n.map(a=>a.id===t?{...a,is_read:!0}:a)),i(Math.max(0,o-1))}catch(s){console.error("Failed to mark notification as read:",s)}},b=async()=>{f(!0);try{const t=localStorage.getItem("access_token");await fetch("/api/v1/notifications/read-all",{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),c(n.map(s=>({...s,is_read:!0}))),i(0)}catch(t){console.error("Failed to mark all as read:",t)}finally{f(!1)}},v=async t=>{try{const s=localStorage.getItem("access_token");await fetch(`/api/v1/notifications/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});const a=n.find(l=>l.id===t);c(n.filter(l=>l.id!==t)),a&&!a.is_read&&i(Math.max(0,o-1))}catch(s){console.error("Failed to delete notification:",s)}},k=t=>{t.is_read||p(t.id),t.action_url&&(window.location.href=t.action_url),r(!1)},C=t=>{switch(t){case"follow":return"ðŸ‘¤";case"comment":return"ðŸ’¬";case"mention":return"@";case"like":return"â¤ï¸";case"share":return"ðŸ”—";case"collaboration_invite":return"ðŸ¤";case"beta_request":return"ðŸ“–";default:return"ðŸ””"}},_=t=>{const s=new Date(t),l=new Date().getTime()-s.getTime(),m=Math.floor(l/6e4),g=Math.floor(l/36e5),j=Math.floor(l/864e5);return m<1?"Just now":m<60?`${m}m ago`:g<24?`${g}h ago`:j<7?`${j}d ago`:s.toLocaleDateString()};return e.jsxs("div",{className:"relative",ref:h,children:[e.jsxs("button",{onClick:()=>r(!x),className:"relative p-2 text-gray-400 hover:text-white transition-colors","aria-label":"Notifications",children:[e.jsx(y,{className:"w-6 h-6"}),o>0&&e.jsx("span",{className:"absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full",children:o>99?"99+":o})]}),x&&e.jsxs("div",{className:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-[600px] flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Notifications"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[o>0&&e.jsx("button",{onClick:b,disabled:N,className:"text-sm text-indigo-600 hover:text-indigo-800 disabled:opacity-50",title:"Mark all as read",children:e.jsx(w,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(B,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-y-auto flex-1",children:n.length===0?e.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No notifications yet"})]}):e.jsx("ul",{children:n.map(t=>e.jsx("li",{className:`border-b border-gray-100 last:border-b-0 ${t.is_read?"bg-white":"bg-indigo-50"} hover:bg-gray-50 transition-colors`,children:e.jsxs("div",{className:"px-4 py-3 flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 text-2xl",children:C(t.type)}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>k(t),children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:t.message}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:_(t.created_at)})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[!t.is_read&&e.jsx("button",{onClick:s=>{s.stopPropagation(),p(t.id)},className:"text-indigo-600 hover:text-indigo-800",title:"Mark as read",children:e.jsx(w,{className:"w-4 h-4"})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),v(t.id)},className:"text-gray-400 hover:text-red-600",title:"Delete",children:e.jsx(S,{className:"w-4 h-4"})})]})]})},t.id))})}),n.length>0&&e.jsx("div",{className:"px-4 py-3 border-t border-gray-200 text-center",children:e.jsx("a",{href:"/notifications",className:"text-sm text-indigo-600 hover:text-indigo-800 font-medium",onClick:()=>r(!1),children:"View all notifications"})})]})]})}function R({user:n,currentPage:c}){const o=r=>{window.location.href=r},i=r=>window.location.pathname===r||c===r,x=async()=>{await $.logout(),window.location.href="/login"};return e.jsx("header",{className:"border-b sticky top-0 z-50 shadow-sm",style:{backgroundColor:"#524944",borderColor:"#6C6A68"},children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>o("/"),className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[e.jsx(T,{className:"w-8 h-8",style:{color:"#B34B0C"}}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Warden"})]}),n&&e.jsxs("nav",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>o("/characters"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${i("/characters")?"text-white font-medium":"text-white hover:bg-opacity-20"}`,style:i("/characters")?{backgroundColor:"#B34B0C"}:{},children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx("span",{children:"Characters"})]}),e.jsxs("button",{onClick:()=>o("/profile-settings"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${i("/profile-settings")?"text-white font-medium":"text-white hover:bg-opacity-20"}`,style:i("/profile-settings")?{backgroundColor:"#B34B0C"}:{},children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{children:"Settings"})]}),e.jsx(E,{}),e.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-4 py-2 rounded-lg transition-colors text-white hover:opacity-80",style:{color:"#B34B0C"},children:[e.jsx(M,{className:"w-5 h-5"}),e.jsx("span",{children:"Log Out"})]})]})]})})})}export{R as N};
