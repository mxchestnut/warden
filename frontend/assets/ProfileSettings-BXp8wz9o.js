import{r as n,j as e}from"./editor-B5c-jJ5G.js";import{a as N}from"./index-DqgK5sIq.js";import{N as T}from"./Navigation-GmQBcWxU.js";import{k as G}from"./lucide-BFpd_Hhe.js";import"./matrix-DowZW4Yz.js";function V(){const[i,E]=n.useState(null),[R,C]=n.useState(!0),[r,g]=n.useState("profile"),[H,J]=n.useState(!1),[B,t]=n.useState(null),[j,a]=n.useState(null),[c,w]=n.useState(""),[l,y]=n.useState(""),[s,p]=n.useState(!1),[k,v]=n.useState(""),[b,S]=n.useState(!1),[h,D]=n.useState(!1),[x,A]=n.useState(null),[P,U]=n.useState(null),[u,F]=n.useState(!1);n.useEffect(()=>{f(),W()},[]);const f=async()=>{try{C(!0);const o=await N.getCurrentUser();o&&E({...o,pathCompanionConnected:!!o.pathcompanionUsername,pathCompanionUsername:o.pathcompanionUsername||""})}catch(o){console.error("Failed to load user:",o),t("Failed to load profile")}finally{C(!1)}},W=async()=>{try{const o=await fetch("/api/auth/discord-settings",{credentials:"include"});if(o.ok){const d=await o.json();S(d.hasToken)}}catch(o){console.error("Failed to load Discord settings:",o)}},z=async()=>{if(!c||!l){t("Please enter both username and password");return}try{p(!0),t(null),a(null);const o=await fetch("/api/auth/pathcompanion/connect",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:c,password:l})});if(!o.ok){const m=await o.json();throw new Error(m.error||"Failed to connect PathCompanion account")}const d=await o.json();a("PathCompanion account connected successfully!"),y(""),await f()}catch(o){t(o instanceof Error?o.message:"Failed to connect PathCompanion")}finally{p(!1)}},O=async()=>{if(confirm("Are you sure you want to disconnect your PathCompanion account?"))try{if(p(!0),t(null),a(null),!(await fetch("/api/auth/pathcompanion/disconnect",{method:"POST",credentials:"include"})).ok)throw new Error("Failed to disconnect PathCompanion account");a("PathCompanion account disconnected successfully"),w(""),y(""),await f()}catch(o){t(o instanceof Error?o.message:"Failed to disconnect PathCompanion")}finally{p(!1)}},L=async()=>{try{D(!0),t(null),a(null);const o=await fetch("/api/auth/discord-settings",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({botToken:k||null})});if(!o.ok){const m=await o.json();throw new Error(m.error||"Failed to save Discord settings")}const d=await o.json();a("Discord bot token saved successfully!"),S(d.hasToken),v("")}catch(o){t(o instanceof Error?o.message:"Failed to save Discord settings")}finally{D(!1)}},I=async()=>{try{F(!0),t(null);const o=await fetch("/api/auth/generate-discord-code",{method:"POST",credentials:"include"});if(!o.ok){const m=await o.json();throw new Error(m.error||"Failed to generate connection code")}const d=await o.json();A(d.code),U(new Date(d.expiresAt)),a("Connection code generated! Use it in Discord with !connect")}catch(o){t(o instanceof Error?o.message:"Failed to generate connection code")}finally{F(!1)}};return R?e.jsxs("div",{style:{display:"flex",minHeight:"100vh",backgroundColor:"#37322E"},children:[e.jsx(T,{user:i}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("p",{style:{color:"white"},children:"Loading..."})})]}):e.jsxs("div",{style:{display:"flex",minHeight:"100vh",backgroundColor:"#37322E"},children:[e.jsx(T,{user:i}),e.jsxs("div",{style:{flex:1,padding:"2rem",maxWidth:"1200px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h1",{style:{fontSize:"2rem",fontWeight:"bold",color:"white",marginBottom:"0.5rem"},children:"Profile & Settings"}),e.jsx("p",{style:{color:"#B3B2B0"},children:"Manage your account settings and integrations"})]}),B&&e.jsx("div",{style:{backgroundColor:"#7F1D1D",color:"white",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem"},children:B}),j&&e.jsx("div",{style:{backgroundColor:"#065F46",color:"white",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem"},children:j}),e.jsx("div",{style:{borderBottom:"2px solid #4A4540",marginBottom:"2rem"},children:e.jsxs("div",{style:{display:"flex",gap:"2rem"},children:[e.jsx("button",{onClick:()=>g("profile"),style:{padding:"1rem",color:r==="profile"?"#D4AF37":"#B3B2B0",borderBottom:r==="profile"?"2px solid #D4AF37":"none",background:"none",border:"none",cursor:"pointer",fontWeight:r==="profile"?"bold":"normal"},children:"Profile"}),e.jsx("button",{onClick:()=>g("pathcompanion"),style:{padding:"1rem",color:r==="pathcompanion"?"#D4AF37":"#B3B2B0",borderBottom:r==="pathcompanion"?"2px solid #D4AF37":"none",background:"none",border:"none",cursor:"pointer",fontWeight:r==="pathcompanion"?"bold":"normal"},children:"PathCompanion"}),e.jsx("button",{onClick:()=>g("discord"),style:{padding:"1rem",color:r==="discord"?"#D4AF37":"#B3B2B0",borderBottom:r==="discord"?"2px solid #D4AF37":"none",background:"none",border:"none",cursor:"pointer",fontWeight:r==="discord"?"bold":"normal"},children:"Discord Bot"})]})}),r==="profile"&&i&&e.jsxs("div",{style:{backgroundColor:"#4A4540",borderRadius:"0.75rem",padding:"2rem"},children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"white",marginBottom:"1.5rem"},children:"Account Information"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"Username"}),e.jsx("input",{type:"text",value:i.username,disabled:!0,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"#888",cursor:"not-allowed"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"Account ID"}),e.jsx("input",{type:"text",value:i.id,disabled:!0,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"#888",cursor:"not-allowed"}})]}),i.isAdmin&&e.jsx("div",{style:{backgroundColor:"#B34B0C",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",display:"inline-block"},children:e.jsx("strong",{children:"Admin Account"})})]})]}),r==="pathcompanion"&&e.jsxs("div",{style:{backgroundColor:"#4A4540",borderRadius:"0.75rem",padding:"2rem"},children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"white",marginBottom:"1rem"},children:"PathCompanion Integration"}),e.jsx("p",{style:{color:"#B3B2B0",marginBottom:"1.5rem"},children:"Connect your PathCompanion account to sync characters and access game features."}),i?.pathCompanionConnected?e.jsxs("div",{children:[e.jsxs("div",{style:{backgroundColor:"#065F46",color:"white",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(G,{className:"w-5 h-5"}),e.jsxs("span",{children:["Connected as ",e.jsx("strong",{children:i.pathCompanionUsername})]})]}),e.jsx("button",{onClick:O,disabled:s,style:{backgroundColor:"#7F1D1D",color:"white",padding:"0.75rem 1.5rem",borderRadius:"0.5rem",border:"none",cursor:s?"not-allowed":"pointer",opacity:s?.6:1},children:s?"Disconnecting...":"Disconnect PathCompanion"})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"PathCompanion Username"}),e.jsx("input",{type:"text",value:c,onChange:o=>w(o.target.value),placeholder:"Enter your PathCompanion username",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"white"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"PathCompanion Password"}),e.jsx("input",{type:"password",value:l,onChange:o=>y(o.target.value),placeholder:"Enter your PathCompanion password",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"white"}})]}),e.jsx("button",{onClick:z,disabled:s||!c||!l,style:{backgroundColor:"#B34B0C",color:"white",padding:"0.75rem 1.5rem",borderRadius:"0.5rem",border:"none",cursor:s||!c||!l?"not-allowed":"pointer",opacity:s||!c||!l?.6:1},children:s?"Connecting...":"Connect PathCompanion"})]})]}),r==="discord"&&e.jsxs("div",{style:{backgroundColor:"#4A4540",borderRadius:"0.75rem",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"white",marginBottom:"1rem"},children:"Discord Account Connection"}),e.jsx("p",{style:{color:"#B3B2B0",marginBottom:"1.5rem"},children:"Link your Discord account to use Warden bot commands with your characters."}),x?e.jsxs("div",{style:{backgroundColor:"#065F46",borderRadius:"0.75rem",padding:"1.5rem",marginBottom:"1rem"},children:[e.jsx("p",{style:{color:"white",marginBottom:"1rem",fontSize:"0.875rem"},children:"Your connection code (expires in 15 minutes):"}),e.jsx("div",{style:{backgroundColor:"#064E3B",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem",fontFamily:"monospace",fontSize:"1.5rem",fontWeight:"bold",color:"#10B981",textAlign:"center",letterSpacing:"0.2em"},children:x}),e.jsx("p",{style:{color:"white",fontSize:"0.875rem",marginBottom:"0.5rem"},children:"To connect your Discord account:"}),e.jsxs("ol",{style:{color:"#B3B2B0",fontSize:"0.875rem",paddingLeft:"1.5rem",marginBottom:"1rem"},children:[e.jsx("li",{children:"Open Discord"}),e.jsx("li",{children:"Send this command in any channel or DM to Warden bot:"})]}),e.jsxs("div",{style:{backgroundColor:"#1F2937",padding:"0.75rem",borderRadius:"0.5rem",fontFamily:"monospace",color:"#10B981",marginBottom:"1rem"},children:["!connect ",x]}),P&&e.jsxs("p",{style:{color:"#FCD34D",fontSize:"0.75rem"},children:["⏱️ Expires at ",P.toLocaleTimeString()]})]}):e.jsx("button",{onClick:I,disabled:u,style:{backgroundColor:"#5865F2",color:"white",padding:"0.75rem 1.5rem",borderRadius:"0.5rem",border:"none",cursor:u?"not-allowed":"pointer",opacity:u?.6:1,fontWeight:"bold"},children:u?"Generating...":"Generate Discord Connection Code"})]}),e.jsxs("div",{style:{borderTop:"1px solid #666",paddingTop:"2rem"},children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"white",marginBottom:"1rem"},children:"Discord Bot Settings"}),e.jsx("p",{style:{color:"#B3B2B0",marginBottom:"1.5rem"},children:"Configure your personal Discord bot token for character webhooks and notifications."}),b&&e.jsx("div",{style:{backgroundColor:"#065F46",color:"white",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem"},children:"Discord bot token is configured"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",color:"#B3B2B0",marginBottom:"0.5rem"},children:"Discord Bot Token"}),e.jsx("input",{type:"password",value:k,onChange:o=>v(o.target.value),placeholder:b?"Enter new token to update":"Enter your Discord bot token",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #666",backgroundColor:"#333",color:"white"}})]}),e.jsx("button",{onClick:L,disabled:h,style:{backgroundColor:"#B34B0C",color:"white",padding:"0.75rem 1.5rem",borderRadius:"0.5rem",border:"none",cursor:h?"not-allowed":"pointer",opacity:h?.6:1},children:h?"Saving...":b?"Update Token":"Save Token"})]})]})]})]})]})}export{V as ProfileSettings};
