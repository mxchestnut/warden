import{r as s,j as e}from"./editor-B5c-jJ5G.js";import{a as m}from"./index-BVoSnxsl.js";import{z as u}from"./lucide-Dq8yrhg5.js";import"./matrix-DowZW4Yz.js";const g="";function v(){const[i,r]=s.useState(null),c=s.useRef(!1);return s.useEffect(()=>{const l=new URLSearchParams(window.location.search),a=l.get("code");if(a){const o=`oauth_code_${a}`;if(sessionStorage.getItem(o)){console.error("[AuthCallback] Code already processed, aborting"),r("This login link has already been used. Please try logging in again.");return}sessionStorage.setItem(o,"true"),console.log("[AuthCallback] Marked code as processing:",a.substring(0,10)+"...")}if(c.current){console.log("[AuthCallback] Already handled in this component instance, skipping");return}c.current=!0,(async()=>{const o=l.get("error");if(o){r(`Authentication error: ${o}`);return}if(!a){r("No authorization code received");return}console.log("[AuthCallback] Processing authorization code...");try{const t=await m.getCurrentUser();console.log("[AuthCallback] Successfully authenticated user:",t?.email);const h=`oauth_code_${a}`;sessionStorage.removeItem(h);const d=localStorage.getItem("invitation_token");if(d){console.log("[AuthCallback] User signed up via invitation, marking as accepted");try{const n=localStorage.getItem("access_token");await fetch(`${g}/api/v1/invitations/accept/${d}`,{method:"POST",headers:{Authorization:`Bearer ${n}`}}),localStorage.removeItem("invitation_token"),localStorage.removeItem("invitation_email")}catch(n){console.error("[AuthCallback] Failed to mark invitation as accepted:",n)}}t&&!t.username?(console.log("[AuthCallback] Redirecting to onboarding (no username)"),window.location.href="/onboarding"):(console.log("[AuthCallback] Redirecting to feed (user complete)"),window.location.href="/feed")}catch(t){console.error("[AuthCallback] Authentication failed:",t),r(t instanceof Error?t.message:"Authentication failed")}})()},[]),i?e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md px-6",children:[e.jsx(u,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-neutral-darkest mb-2",children:"Authentication Error"}),e.jsx("p",{className:"text-neutral mb-6",children:i}),e.jsx("a",{href:"/",className:"inline-block bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-lg transition-colors",children:"Return to Home"})]})}):e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"w-16 h-16 text-primary mx-auto mb-4 animate-pulse"}),e.jsx("h1",{className:"text-2xl font-bold text-neutral-darkest mb-2",children:"Logging you in..."}),e.jsx("p",{className:"text-neutral",children:"Please wait while we complete your authentication."})]})})}export{v as AuthCallback};
