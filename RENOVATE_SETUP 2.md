# Renovate - Automated Dependency Updates

## Overview

**Renovate** automatically creates Pull Requests to update dependencies in your project. This keeps dependencies up-to-date with minimal manual effort while maintaining control over what gets merged.

## Key Features

‚úÖ **Automatic PRs** - Creates PRs for outdated dependencies weekly  
‚úÖ **Automerge** - Minor/patch updates auto-merge after CI passes  
‚úÖ **Security First** - Prioritizes security updates  
‚úÖ **Smart Grouping** - Groups related updates together (React, Vite, Testing, etc.)  
‚úÖ **Configurable** - Respects version constraints (Zod 3.22.4, TipTap v2)  
‚úÖ **Zero Config** - Works immediately after enabling

---

## Setup

### 1. Enable Renovate on GitHub

**Option A: GitHub App (Recommended)**
1. Go to https://github.com/apps/renovate
2. Click "Install"
3. Select your repository
4. Authorize the app

**Option B: GitHub Actions**
1. Fork the Renovate GitHub Action
2. Add to `.github/workflows/renovate.yml`

### 2. Configuration File

Renovate is already configured via [renovate.json](./renovate.json) in the project root.

### 3. First Run

Once enabled, Renovate will:
1. Scan your `package.json` files
2. Create an initial "Configure Renovate" PR
3. Start creating dependency update PRs weekly

---

## Configuration

**Location:** [renovate.json](./renovate.json)

### Schedule
```json
"schedule": ["before 5am on monday"]
```
- Runs every Monday before 5am EST
- Avoids creating PRs during work hours

### Auto-merge Strategy
```json
"automerge": true,
"automergeType": "pr",
"automergeStrategy": "squash",
"platformAutomerge": true
```

**What auto-merges:**
- ‚úÖ Minor updates (e.g., 1.2.0 ‚Üí 1.3.0)
- ‚úÖ Patch updates (e.g., 1.2.0 ‚Üí 1.2.1)
- ‚úÖ Security patches
- ‚ùå Major updates (requires manual review)

### Grouping Rules

Dependencies are grouped for easier review:

| Group | Packages |
|-------|----------|
| React ecosystem | react, react-dom, @types/react |
| Vite ecosystem | vite, @vitejs/* |
| Testing packages | vitest, @testing-library/*, playwright |
| Linting & formatting | eslint, prettier, @typescript-eslint/* |

### Version Constraints

**Packages kept at specific versions:**
```json
{
  "matchPackageNames": ["zod"],
  "enabled": false  // Keeps Zod at 3.22.4
}
```

**Packages restricted to major version:**
```json
{
  "matchPackagePatterns": ["^@tiptap/"],
  "allowedVersions": "^2.0.0"  // TipTap v2 only
}
```

```json
{
  "matchPackageNames": ["@types/node"],
  "allowedVersions": "^22.0.0"  // Node 22 LTS only
}
```

### PR Limits
```json
"prConcurrentLimit": 5,
"prHourlyLimit": 2
```
- Max 5 PRs open at once
- Max 2 PRs created per hour
- Prevents flooding your PR list

---

## How It Works

### Weekly Update Cycle

**Monday before 5am:**
1. Renovate checks for outdated dependencies
2. Creates grouped PRs (e.g., "Update all non-major dependencies")
3. Runs your CI/CD tests (GitHub Actions)
4. If tests pass ‚Üí Auto-merges minor/patch updates
5. If tests fail ‚Üí Leaves PR open for manual review

**Major Updates:**
- Created as separate PRs
- Labeled `major-update` and `review-required`
- Assigned to repository owner
- Never auto-merged

**Security Updates:**
- Created immediately (ignores schedule)
- Labeled `security` and `urgent`
- High priority (processed first)
- Auto-merged if patch version

### Monthly Maintenance

**First day of month at 3am:**
- Lock file maintenance PR
- Updates package-lock.json to latest compatible versions
- Auto-merges after CI passes

---

## PR Format

### Example PR Title
```
‚¨ÜÔ∏è Update React ecosystem to 19.2.4
```

### Example PR Body
```markdown
## Update React ecosystem

| Package | Change | Age | Adoption | Passing | Confidence |
|---------|--------|-----|----------|---------|------------|
| react | 19.2.3 ‚Üí 19.2.4 | üü¢ | üü¢ | üü¢ | üü¢ |
| react-dom | 19.2.3 ‚Üí 19.2.4 | üü¢ | üü¢ | üü¢ | üü¢ |

### Release Notes
- Fix: Memory leak in useEffect cleanup
- Perf: Optimize reconciliation algorithm

---
This PR has been generated by Renovate Bot.
```

### Badges Explained
- **Age** - How long since release
- **Adoption** - Percentage of users on this version
- **Passing** - Tests passing for this version
- **Confidence** - Overall confidence score

---

## Common Workflows

### Reviewing a Major Update

1. **Check the PR** - Renovate creates a PR like "Update TypeScript to v6.0.0"
2. **Review breaking changes** - Click release notes link
3. **Test locally:**
   ```bash
   git checkout renovate/typescript-6.x
   npm install
   npm run build
   npm test
   ```
4. **If tests pass** - Merge the PR
5. **If tests fail** - Fix breaking changes, commit to PR branch

### Pausing Updates

**Temporarily disable Renovate:**
```bash
# Add to renovate.json
{
  "enabled": false
}
```

**Ignore a specific package:**
```json
{
  "ignoreDeps": ["package-name"]
}
```

### Forcing an Immediate Run

**Via GitHub:**
1. Go to repository settings
2. Renovate App ‚Üí Configuration
3. Click "Check now"

**Via Dashboard:**
- https://app.renovatebot.com/dashboard

---

## Integration with CI/CD

Renovate PRs trigger your existing CI/CD pipeline defined in [.github/workflows/tests.yml](./.github/workflows/tests.yml):

```yaml
name: Tests
on: pull_request

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm install
      - run: npm test
```

**Auto-merge only happens if:**
- ‚úÖ All tests pass
- ‚úÖ Update is minor/patch (not major)
- ‚úÖ No merge conflicts

---

## Security Updates

Renovate prioritizes security:

```json
{
  "vulnerabilityAlerts": {
    "labels": ["security", "urgent"],
    "assignees": ["@me"],
    "prPriority": 20  // Highest priority
  }
}
```

**How it works:**
1. GitHub detects vulnerability (via Dependabot alerts)
2. Renovate creates immediate PR (ignores schedule)
3. Labeled `security` and `urgent`
4. If patch update ‚Üí Auto-merges after tests
5. If major update ‚Üí Requires manual review

---

## Customizing Configuration

### Change Schedule
```json
"schedule": ["every weekend"]  // Saturday/Sunday
"schedule": ["after 10pm every weekday"]
"schedule": ["before 5am on the first day of the month"]
```

### Change Auto-merge Behavior
```json
"automerge": false  // Disable all auto-merging
```

### Add Custom Package Groups
```json
{
  "matchPackagePatterns": ["^@mycompany/"],
  "groupName": "Internal packages"
}
```

### Change PR Limits
```json
"prConcurrentLimit": 10,  // Allow more PRs
"prHourlyLimit": 5
```

---

## Troubleshooting

### No PRs being created?

1. **Check Renovate is enabled:**
   - GitHub ‚Üí Settings ‚Üí Integrations ‚Üí Renovate
2. **Check schedule:**
   - It only runs Mondays before 5am
   - Force a run from dashboard
3. **Check logs:**
   - https://app.renovatebot.com/dashboard
   - Click repository ‚Üí View logs

### PRs not auto-merging?

1. **Check CI status** - Tests must pass
2. **Check update type** - Only minor/patch auto-merge
3. **Check conflicts** - PRs with conflicts don't auto-merge
4. **Check branch protection** - Must allow Renovate bot to merge

### Too many PRs?

Adjust limits:
```json
"prConcurrentLimit": 2,  // Reduce from 5
"prHourlyLimit": 1       // Reduce from 2
```

### Want to skip a package?

```json
"ignoreDeps": ["some-package"]
```

---

## Best Practices

### ‚úÖ DO:
1. **Let minor/patch updates auto-merge** - Saves time
2. **Review major updates carefully** - Check breaking changes
3. **Enable branch protection** - Require CI before merge
4. **Monitor security PRs** - High priority
5. **Keep configuration in sync** - Update renovate.json as needed

### ‚ùå DON'T:
1. **Don't disable Renovate** - Dependencies get outdated fast
2. **Don't ignore all updates** - Creates technical debt
3. **Don't skip major updates forever** - Plan upgrade paths
4. **Don't auto-merge everything** - Major updates need review

---

## Dashboard

Access the Renovate dashboard:
- **URL:** https://app.renovatebot.com/dashboard
- **Login:** Via GitHub account
- **Features:**
  - View all repositories
  - See pending PRs
  - Check run history
  - Force manual runs
  - View logs

---

## Examples from Warden Config

### Keeping Zod at 3.22.4
```json
{
  "matchPackageNames": ["zod"],
  "enabled": false
}
```
**Why:** User requested to keep Zod at current version

### Keeping TipTap at v2
```json
{
  "matchPackagePatterns": ["^@tiptap/"],
  "allowedVersions": "^2.0.0"
}
```
**Why:** TipTap v3 has breaking changes with collaboration-cursor

### Keeping @types/node at v22
```json
{
  "matchPackageNames": ["@types/node"],
  "allowedVersions": "^22.0.0"
}
```
**Why:** Using Node 22 LTS

---

## Migration Guide

If you were manually updating dependencies:

### Before (Manual)
```bash
npm outdated
npm update
npm audit fix
git add package.json package-lock.json
git commit -m "Update dependencies"
git push
```

### After (Renovate)
1. Wait for Monday
2. Review PR
3. Merge (or let it auto-merge)

**Time saved:** ~30 minutes per week

---

## Related Documentation

- [TECH_STACK.md](./TECH_STACK.md) - Full technology stack
- [TESTING.md](./TESTING.md) - CI/CD testing setup
- [Renovate Docs](https://docs.renovatebot.com/) - Official documentation
- [Configuration Options](https://docs.renovatebot.com/configuration-options/) - All config options
